<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Platform Shock — Mini</title>
  <style>
    :root{
      --bg:#0b1220; --panel:rgba(255,255,255,.06); --line:rgba(255,255,255,.10);
      --text:#eaf0ff; --muted:#a9b6d3; --accent:#7c3aed; --good:#22c55e;
      --radius:16px; --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:
        radial-gradient(900px 540px at 10% 0%, rgba(124,58,237,.22), transparent 60%),
        radial-gradient(900px 540px at 90% 10%, rgba(34,197,94,.14), transparent 55%),
        var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10;
      background: rgba(11,18,32,.72);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }
    .wrap{ max-width:1000px; margin:0 auto; padding:14px 16px; }
    .top{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; flex-wrap:wrap; }
    h1{ margin:0; font-size:16px; letter-spacing:.2px; }
    .sub{ margin-top:4px; color:var(--muted); font-size:12px; line-height:1.3; max-width:720px; }
    .chip{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      padding:7px 10px; border-radius:999px;
      font-size:12px; color:var(--muted);
      display:flex; gap:6px; align-items:center;
    }
    .chip strong{ color:var(--text); font-weight:650; }
    main{ max-width:1000px; margin:14px auto 60px; padding:0 16px; }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }

    .card{
      border:1px solid var(--line);
      background: var(--panel);
      border-radius: var(--radius);
      padding:14px;
    }
    .title{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:10px;
    }
    .title h2{ margin:0; font-size:13px; font-weight:700; color:var(--text); }
    .muted{ color:var(--muted); font-size:12px; }
    .row{ display:grid; grid-template-columns: 120px 1fr 52px; gap:10px; align-items:center; margin:10px 0; }
    label{ color:var(--muted); font-size:12px; }
    input[type="range"]{ width:100%; accent-color: var(--accent); }
    .num{
      font-family: var(--mono); font-size:12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      padding:7px 8px; border-radius:12px; text-align:right;
    }
    .rank{ display:grid; gap:8px; margin-top:8px; }
    .item{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius:14px;
      padding:10px;
    }
    .itemtop{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
    .name{ font-size:13px; font-weight:650; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .score{ font-family:var(--mono); font-size:12px; }
    .barwrap{
      margin-top:8px; height:10px; border-radius:999px;
      background: rgba(255,255,255,.06);
      overflow:hidden; border:1px solid var(--line);
    }
    .bar{ height:100%; width:0%; background: linear-gradient(90deg, #7c3aed, #22c55e); }

    select, textarea, input[type="text"]{
      width:100%;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color:var(--text);
      border-radius:12px;
      padding:10px;
      font-size:13px;
      outline:none;
    }
    textarea{ min-height: 100px; resize: vertical; }
    .btns{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
    }
    button:hover{ background: rgba(255,255,255,.10); }
    button.primary{ background: rgba(124,58,237,.22); border-color: rgba(124,58,237,.35); }
    button.primary:hover{ background: rgba(124,58,237,.30); }
    .status{ margin-top:8px; font-size:12px; color:var(--muted); min-height:16px; }
  </style>
</head>

<body>
<header>
  <div class="wrap top">
    <div>
      <h1>Platform Shock — Mini</h1>
      <div class="sub">Adjust weights → see rank → write one decision.</div>
    </div>
    <div class="chip"><strong>Dependency</strong> <span>is inverted</span></div>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card" aria-label="Weights">
      <div class="title">
        <h2>Weights</h2>
        <div class="muted" id="lens">Balanced</div>
      </div>

      <div class="row">
        <label for="wRnd">R&amp;D</label>
        <input id="wRnd" type="range" min="0" max="100" value="30" />
        <div class="num" id="wRndVal">0.30</div>
      </div>
      <div class="row">
        <label for="wDep">Dependency</label>
        <input id="wDep" type="range" min="0" max="100" value="25" />
        <div class="num" id="wDepVal">0.25</div>
      </div>
      <div class="row">
        <label for="wReg">Regulation</label>
        <input id="wReg" type="range" min="0" max="100" value="25" />
        <div class="num" id="wRegVal">0.25</div>
      </div>
      <div class="row">
        <label for="wWork">Workforce</label>
        <input id="wWork" type="range" min="0" max="100" value="20" />
        <div class="num" id="wWorkVal">0.20</div>
      </div>

      <div class="btns">
        <button type="button" id="reset">Reset</button>
        <button type="button" id="random">Random</button>
      </div>
    </section>

    <section class="card" aria-label="Ranking">
      <div class="title">
        <h2>Ranking</h2>
        <div class="muted">0–100</div>
      </div>
      <div class="rank" id="rank"></div>
    </section>

    <section class="card" style="grid-column: 1 / -1;" aria-label="Decision">
      <div class="title">
        <h2>Decision</h2>
        <div class="muted">2–3 sentences</div>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
        <select id="role" aria-label="Role">
          <option value="">Role…</option>
          <option value="stateA">Large tech-producing state</option>
          <option value="stateB">Rival tech-producing state</option>
          <option value="small">Small dependent state</option>
          <option value="platform">Platform firm</option>
          <option value="reg">Regulator / standards bloc</option>
        </select>

        <select id="action" aria-label="Action">
          <option value="">Action…</option>
          <option>Regulate</option>
          <option>Substitute</option>
          <option>Bargain</option>
          <option>Align</option>
          <option>Diversify</option>
          <option>Retaliate</option>
        </select>

        <select id="indicator" aria-label="Indicator">
          <option value="">Indicator…</option>
          <option value="rnd">R&amp;D</option>
          <option value="dep">Dependency</option>
          <option value="reg">Regulation</option>
          <option value="work">Workforce</option>
        </select>
      </div>

      <div style="margin-top:10px; display:grid; grid-template-columns: 1fr 2fr; gap:10px;">
        <input id="concept" type="text" placeholder="capability / control / legitimacy" aria-label="Concept link" />
        <textarea id="why" placeholder="Write the justification here." aria-label="Justification"></textarea>
      </div>

      <div class="btns">
        <button type="button" class="primary" id="save">Save</button>
        <button type="button" id="export">Export JSON</button>
        <button type="button" id="clear">Clear</button>
      </div>
      <div class="status" id="status" aria-live="polite"></div>
    </section>
  </div>
</main>

<script>
(() => {
  "use strict";
  const LS = "platform_shock_mini_v1";
  const $ = (s) => document.querySelector(s);

  const data = [
    { a: "United States", rnd: 3.5, dep: 20, reg: 4.5, work: 9.0 },
    { a: "China",        rnd: 2.6, dep: 15, reg: 4.0, work: 7.5 },
    { a: "EU",           rnd: 2.3, dep: 35, reg: 5.0, work: 6.8 },
    { a: "UAE",          rnd: 1.5, dep: 55, reg: 3.5, work: 4.2 },
    { a: "Qatar",        rnd: 1.0, dep: 60, reg: 3.0, work: 3.8 },
    { a: "India",        rnd: 0.7, dep: 40, reg: 2.5, work: 5.0 }
  ];

  const meta = {
    rnd: { higherBetter: true },
    dep: { higherBetter: false }, // inverted
    reg: { higherBetter: true },
    work:{ higherBetter: true }
  };

  function minMax(k){
    const v = data.map(r => r[k]);
    return { min: Math.min(...v), max: Math.max(...v) };
  }
  function norm(x,k){
    const {min,max} = minMax(k);
    if (max === min) return 50;
    let t = (x - min) / (max - min);
    if (!meta[k].higherBetter) t = 1 - t;
    return t * 100;
  }

  function weights(){
    const raw = {
      rnd: Number($("#wRnd").value),
      dep: Number($("#wDep").value),
      reg: Number($("#wReg").value),
      work:Number($("#wWork").value),
    };
    const sum = raw.rnd + raw.dep + raw.reg + raw.work;
    const w = {};
    for (const k of Object.keys(raw)) w[k] = sum ? raw[k]/sum : 0.25;
    return w;
  }

  function setLens(w){
    const entries = Object.entries(w).sort((a,b)=>b[1]-a[1]);
    const [topK, topV] = entries[0];
    const map = { rnd:"Innovation", dep:"Autonomy", reg:"Governance", work:"Workforce" };
    $("#lens").textContent = (topV >= 0.40) ? map[topK] : "Balanced";
  }

  function updateWeightUI(){
    const w = weights();
    $("#wRndVal").textContent = w.rnd.toFixed(2);
    $("#wDepVal").textContent = w.dep.toFixed(2);
    $("#wRegVal").textContent = w.reg.toFixed(2);
    $("#wWorkVal").textContent = w.work.toFixed(2);
    setLens(w);
  }

  function scores(){
    const w = weights();
    return data.map(r => {
      const s =
        norm(r.rnd,"rnd")*w.rnd +
        norm(r.dep,"dep")*w.dep +
        norm(r.reg,"reg")*w.reg +
        norm(r.work,"work")*w.work;
      return {...r, score:s};
    }).sort((a,b)=>b.score-a.score);
  }

  function renderRank(){
    const list = $("#rank");
    list.innerHTML = "";
    scores().forEach((r, i) => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="itemtop">
          <div class="name">${i+1}. ${r.a}</div>
          <div class="score">${r.score.toFixed(1)}</div>
        </div>
        <div class="barwrap"><div class="bar" style="width:${Math.max(0,Math.min(100,r.score)).toFixed(1)}%"></div></div>
      `;
      list.appendChild(div);
    });
  }

  function status(msg, err=false){
    const el = $("#status");
    el.textContent = msg;
    el.style.color = err ? "var(--bad)" : "var(--muted)";
    setTimeout(() => { if (el.textContent === msg) el.textContent = ""; }, 2500);
  }

  function snapshot(){
    return {
      meta:{ title:"Platform Shock — Mini", savedAt: new Date().toISOString() },
      weights: weights(),
      ranking: scores().map(r => ({ actor:r.a, score:Number(r.score.toFixed(1)) })),
      decision:{
        role: $("#role").value,
        action: $("#action").value,
        indicator: $("#indicator").value,
        concept: $("#concept").value.trim(),
        why: $("#why").value.trim()
      }
    };
  }

  function saveLocal(){
    try{ localStorage.setItem(LS, JSON.stringify(snapshot())); }catch(e){}
  }

  function loadLocal(){
    try{
      const raw = localStorage.getItem(LS);
      if (!raw) return;
      const s = JSON.parse(raw);
      if (s.weights){
        $("#wRnd").value = Math.round(s.weights.rnd*100);
        $("#wDep").value = Math.round(s.weights.dep*100);
        $("#wReg").value = Math.round(s.weights.reg*100);
        $("#wWork").value = Math.round(s.weights.work*100);
      }
      if (s.decision){
        $("#role").value = s.decision.role || "";
        $("#action").value = s.decision.action || "";
        $("#indicator").value = s.decision.indicator || "";
        $("#concept").value = s.decision.concept || "";
        $("#why").value = s.decision.why || "";
      }
    }catch(e){}
  }

  function onChange(){
    updateWeightUI();
    renderRank();
    saveLocal();
  }

  function resetWeights(){
    $("#wRnd").value = 30;
    $("#wDep").value = 25;
    $("#wReg").value = 25;
    $("#wWork").value = 20;
    onChange();
  }

  function randomWeights(){
    const r = [Math.random(),Math.random(),Math.random(),Math.random()];
    const s = r.reduce((a,b)=>a+b,0);
    $("#wRnd").value = Math.round((r[0]/s)*100);
    $("#wDep").value = Math.round((r[1]/s)*100);
    $("#wReg").value = Math.round((r[2]/s)*100);
    $("#wWork").value = Math.round((r[3]/s)*100);
    onChange();
  }

  function validateDecision(){
    const d = snapshot().decision;
    if (!d.role) return "Pick a role.";
    if (!d.action) return "Pick an action.";
    if (!d.indicator) return "Pick an indicator.";
    if (!d.concept) return "Add capability/control/legitimacy.";
    if ((d.why || "").length < 20) return "Write 2–3 sentences.";
    return "";
  }

  function download(name, text){
    const blob = new Blob([text], {type:"application/json;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = name;
    document.body.appendChild(a);
    a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  // Wire UI
  ["#wRnd","#wDep","#wReg","#wWork"].forEach(id => $(id).addEventListener("input", onChange));
  $("#reset").addEventListener("click", resetWeights);
  $("#random").addEventListener("click", randomWeights);

  $("#save").addEventListener("click", () => {
    const err = validateDecision();
    if (err) return status(err, true);
    saveLocal();
    status("Saved.");
  });

  $("#export").addEventListener("click", () => {
    const err = validateDecision();
    if (err) return status(err, true);
    download("platform-shock-mini.json", JSON.stringify(snapshot(), null, 2));
    status("Exported.");
  });

  $("#clear").addEventListener("click", () => {
    $("#role").value = "";
    $("#action").value = "";
    $("#indicator").value = "";
    $("#concept").value = "";
    $("#why").value = "";
    saveLocal();
    status("Cleared.");
  });

  // Init
  loadLocal();
  updateWeightUI();
  renderRank();
})();
</script>
</body>
</html>
